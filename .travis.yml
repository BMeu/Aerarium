sudo: false

language: python

matrix:
  include:
    - python: "3.6"
    - python: "3.6"
      env: FLASK_DEBUG=0
    - python: "3.6-dev"
    - python: "3.7"
      dist: xenial
      sudo: true
    - python: "3.7"
      dist: xenial
      sudo: true
      env: FLASK_DEBUG=0
    - python: "3.7-dev"
    - python: "3.8-dev"
      dist: xenial
      sudo: true
    - python: "nightly"

env:
  global:
    - FLASK_DEBUG=1
    - FLASK_APP=aerarium
    - PIPENV_VERBOSITY=-1
    - SECRET_KEY="Gallia est omnis divisa in partes tres"
    - SYS_ADMINS=aerarium@bastianmeyer.eu

services:
  - mysql

before_install:
  - mysql -e 'CREATE DATABASE aerarium_test;'
  - cp instance/example.env instance/.env
  - sed -i -e 's/# DATABASE_URI=/DATABASE_URI=mysql+pymysql:\/\/root@localhost\/aerarium_test/g' instance/.env

install:
  - pip install pipenv
  - pipenv install --dev
  - pipenv install codecov

script:
  - flake8
  - flask translate compile
  - flask db upgrade
  - coverage run -m unittest discover -v -s tests -p "*_test.py" -t .
  - sphinx-apidoc -o docs/source/api app app/configuration
  - sphinx-build -b html docs/source docs/build

after_success:
- codecov
